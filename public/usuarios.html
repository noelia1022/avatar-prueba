<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Usuarios - Sistema Avatar</title>
</head>
<body>
  <h1>Gestión de Usuarios</h1>
  <form id="userForm">
    <input type="text" id="username" placeholder="Usuario" required>
    <input type="password" id="password" placeholder="Contraseña" required>
    <select id="rol">
      <option value="admin">Administrador</option>
      <option value="profesor">Profesor</option>
    </select>
    <button type="submit">Crear Usuario</button>
  </form>

  <h2>Listado de Usuarios</h2>
  <table border="1" width="100%">
    <thead><tr><th>Usuario</th><th>Rol</th></tr></thead>
    <tbody id="tablaUsuarios"><tr><td colspan="2">Cargando...</td></tr></tbody>
  </table>

  <script>
    const token=localStorage.getItem('token');
    if(!token) location.href="login.html";

    async function cargarUsuarios(){
      const res=await fetch('/api/usuarios',{headers:{Authorization:`Bearer ${token}`}});
      const data=await res.json();
      const tbody=document.getElementById('tablaUsuarios');
      tbody.innerHTML="";
      data.usuarios.forEach(u=>{
        tbody.innerHTML+=`<tr><td>${u.username}</td><td>${u.rol}</td></tr>`;
      });
    }

    document.getElementById('userForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const body={username:username.value,password:password.value,rol:rol.value};
      await fetch('/api/usuarios',{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${token}`},body:JSON.stringify(body)});
      cargarUsuarios();
      e.target.reset();
    });

    document.addEventListener('DOMContentLoaded',cargarUsuarios);
  </script>
</body>
</html>
