<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro Estudiantes - Sistema Avatar</title>
</head>
<body>
  <h1>Registro de Estudiantes</h1>
  <form id="estForm">
    <input type="text" id="nombre" placeholder="Nombre completo" required>
    <input type="text" id="cedula" placeholder="Cédula" required>
    <input type="email" id="correo" placeholder="Correo" required>
    <button type="submit">Registrar</button>
  </form>

  <h2>Listado</h2>
  <table border="1" width="100%">
    <thead><tr><th>Nombre</th><th>Cédula</th><th>Correo</th></tr></thead>
    <tbody id="tablaEstudiantes"><tr><td colspan="3">Cargando...</td></tr></tbody>
  </table>

  <script>
    const token=localStorage.getItem('token');
    if(!token) location.href="login.html";

    async function cargarEstudiantes(){
      const res=await fetch('/api/estudiantes',{headers:{Authorization:`Bearer ${token}`}});
      const data=await res.json();
      const tbody=document.getElementById('tablaEstudiantes');
      tbody.innerHTML='';
      data.estudiantes.forEach(e=>{
        tbody.innerHTML+=`<tr><td>${e.nombre}</td><td>${e.cedula}</td><td>${e.correo}</td></tr>`;
      });
    }

    document.getElementById('estForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const body={nombre:nombre.value,cedula:cedula.value,correo:correo.value};
      await fetch('/api/estudiantes',{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${token}`},body:JSON.stringify(body)});
      cargarEstudiantes();
      e.target.reset();
    });

    document.addEventListener('DOMContentLoaded',cargarEstudiantes);
  </script>
</body>
</html>
